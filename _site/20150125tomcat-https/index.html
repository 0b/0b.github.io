<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/syntax.css" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css" >
    <link rel="icon" href="/css/favicon.ico">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="keywords" content="Tomcat Https 配置,java,tomcat,https,ssl,">
    <meta name="description" content="Tomcat Https 配置 java tomcat https ssl ">
    <meta name="author" content="RainyNight">
    <title>Tomcat Https 配置</title>
</head>
<body>
<!-- 背景 -->
<div class="fixed-background"></div>
<!-- << 顶部导航条,手机屏幕不显示 -->
<nav class="navbar navbar-fixed-top hidden-xs" role="navigation">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-4  col-md-4  col-sm-4">
                <a href="/" class="author entry">
                    <div class="text-block">
                        <span class="lead">
                            RainyNight
                        </span>
                    </div>
                </a>
            </div>
            <div class="col-lg-7  col-md-7  col-sm-7">
                <div class="container-fluid">
                    <div class="row">
                        <ul class="nav nav-pills hidden-xs pull-right" >
                            <li role="presentation"><a href="/" title="Categories" class="font-enlarge-sm entry"><span class='glyphicon glyphicon-menu-hamburger'></span></a></li>
                            <li role="presentation"><a href="#" title="Tags" class="font-enlarge-sm entry"><span class='glyphicon glyphicon-tags'></span></a></li>
                            <li role="presentation"><a href="#" title="Archive" class="font-enlarge-sm entry"><span class='glyphicon glyphicon-book'></span></a></li>
                            <li role="presentation"><a href="#" title="About" class="font-enlarge-sm entry"><span class='glyphicon glyphicon-user'></span></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav >
<!-- 导航条的半透明底座 -->
<div class="hidden-xs" style="background-color:rgba(0,0,0,.3); width:100%; min-height:50px; z-index:999; position:fixed; border-radius:4px;"></div>
<!-- 一个垫子,用来产生正文与导航条的间隔 -->
<div class="pad hidden-xs"></div>
<!-- >> 顶部导航条,手机屏幕不显示 -->
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1 col-sm-10 col-sm-offset-1 overspread">
            <!-- << 只在手机端显示的菜单 -->
            <div class="hidden-lg hidden-md hidden-sm">
                <a href="#" class="btn btn-sm glyphicon glyphicon-option-vertical fixed-right-top" data-toggle="collapse" data-target="#nav-collapse" scroll="false"></a>
                <div id="nav-collapse" class="collapse">
                　　<div class="container-fluid">
                　　    <div class="row">
                            <a href="#" title="About" class="col-xs-3 text-center  font-enlarge-lg entry"><span class='glyphicon glyphicon-user'></span></a>
                            <a href="#" title="Archive" class="col-xs-3 text-center font-enlarge-lg entry"><span class='glyphicon glyphicon-book'></span></a>
                            <a href="#" title="Tags" class="col-xs-3 text-center  font-enlarge-lg entry"><span class='glyphicon glyphicon-tags'></span></a>
                            <a href="/" title="Categories" class="col-xs-3 text-center font-enlarge-lg entry"><span class='glyphicon glyphicon-menu-hamburger'></span></a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- >> 只在手机端显示的菜单 -->
            <div class="wrapper">
                
                    <h1 class="text-center">Tomcat Https 配置</h1>
                    <h5 class="text-success text-center">25 Jan 2015</h5>
                    <hr>
                    
                        <a href="/20150125tricolour" class="btn btn-lg glyphicon glyphicon-menu-left circular-corner fixed-left title pager-btn"></a>
                    
                    
                        <a href="/20150125sort" class="btn btn-lg glyphicon glyphicon-menu-right circular-corner fixed-right title pager-btn"></a>
                    
                
                <h4><code>1</code>.生成秘钥库</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">keytool 
    –genkey
    –keyalg 算法<span class="o">(</span>通常用RSA<span class="o">)</span>
    –dname <span class="s2">&quot;cn=服务器名,</span>
<span class="s2">            ou=组织单位名,</span>
<span class="s2">            o=组织名,</span>
<span class="s2">            l=城市名,</span>
<span class="s2">            st=省/市/自治区,</span>
<span class="s2">            c=国家双字母代码&quot;</span>
    -alias 别名<span class="o">(</span>非必选项<span class="o">)</span>
    -keypass 密码
    -keystore 秘钥库文件名
    -storepass 密码
    -validity 有效天数
</code></pre></div>
<h4><code>2</code>.生成浏览器证书文件</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">keytool
    -export 
    -keystore 秘钥库文件名
    -alias 秘钥库别名<span class="o">(</span>非必选项<span class="o">)</span>
    -storepass 秘钥库密码
    -file 证书文件名
</code></pre></div>
<h4><code>3</code>.生成私钥文件</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">keytool 
    -importkeystore 
    -srckeystore 秘钥库文件名
    -deststoretype PKCS12
    -destkeystore p12文件名

openssl 
    pkcs12 
    -in p12文件名
    -out pem文件名
    -nodes
</code></pre></div>
<h4><code>4</code>.Tomcat配置</h4>

<p>打开 %CATALINA_HOME%/conf/server.xml <br>
解开注释或添加代码(443为https默认端口，不会在URL中显示)</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">&quot;443&quot;</span> <span class="na">protocol=</span><span class="s">&quot;HTTP/1.1&quot;</span> <span class="na">SSLEnabled=</span><span class="s">&quot;true&quot;</span>
    <span class="na">maxThreads=</span><span class="s">&quot;150&quot;</span> <span class="na">scheme=</span><span class="s">&quot;https&quot;</span> <span class="na">secure=</span><span class="s">&quot;true&quot;</span>
    <span class="na">clientAuth=</span><span class="s">&quot;false&quot;</span> <span class="na">sslProtocol=</span><span class="s">&quot;TLS&quot;</span> 
    <span class="na">SSLCertificateFile=</span><span class="s">&quot;证书文件名&quot;</span>   
    <span class="na">SSLCertificateKeyFile=</span><span class="s">&quot;pem文件名&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<h4><code>5</code>.强制https访问</h4>

<p>打开 %CATALINA_HOME%/conf/web.xml <br>
添加代码</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- SSL --&gt;</span>
<span class="nt">&lt;login-config&gt;</span>  
    <span class="c">&lt;!-- Authorization setting for SSL --&gt;</span>  
    <span class="nt">&lt;auth-method&gt;</span>CLIENT-CERT<span class="nt">&lt;/auth-method&gt;</span>  
    <span class="nt">&lt;realm-name&gt;</span>Client Cert Users-only Area<span class="nt">&lt;/realm-name&gt;</span>  
<span class="nt">&lt;/login-config&gt;</span>  
<span class="nt">&lt;security-constraint&gt;</span>  
    <span class="c">&lt;!-- Authorization setting for SSL --&gt;</span>  
    <span class="nt">&lt;web-resource-collection</span> <span class="nt">&gt;</span>  
        <span class="nt">&lt;web-resource-name</span> <span class="nt">&gt;</span>SSL<span class="nt">&lt;/web-resource-name&gt;</span>  
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>  
    <span class="nt">&lt;/web-resource-collection&gt;</span>  
    <span class="nt">&lt;user-data-constraint&gt;</span>  
        <span class="nt">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="nt">&lt;/transport-guarantee&gt;</span>  
    <span class="nt">&lt;/user-data-constraint&gt;</span>  
<span class="nt">&lt;/security-constraint&gt;</span> 
</code></pre></div>
            </div>
            <div class="pad hidden-xs"></div>
        </div>
    </div>
</div>
<script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="/scripts/custom.js"></script>
</body>
</html>
